

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Programming Tutorial - Mecanum Drivetrain &mdash; Game Manual 0 0.0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/gm0-logo.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/gm0-rtd.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Control Loops" href="control-loops.html" />
    <link rel="prev" title="Using the FTC SDK" href="using-the-sdk.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Game Manual 0
          

          
            
            <img src="../../_static/gm0-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../meta/index.html">Meta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-in-ftc/index.html">Getting Started in FTC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rookie-mistakes/index.html">Rookie Mistakes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kit-and-hardware-guide/index.html">Kit and Hardware Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools-list.html">Tools List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../materials-guide.html">Materials Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../drivetrains/index.html">Drivetrains</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../power-transmission/index.html">Power Transmission</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linear-motion-guide/index.html">Linear Motion Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arms/index.html">Arms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../passive-intake/index.html">Passive Intake/Claw</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../active-intake/index.html">Active Intake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motor-guide/index.html">Motor Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../servo-guide/index.html">Servo Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../electronics/index.html">Electronics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Software</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fundamental-concepts.html">Fundamental Concepts of Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="options-for-programming.html">Options for Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-the-sdk.html">Using the FTC SDK</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Programming Tutorial - Mecanum Drivetrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="control-loops.html">Control Loops</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Game Manual 0</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Software</a> &raquo;</li>
        
      <li>Programming Tutorial - Mecanum Drivetrain</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/software/mecanum-drive.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="programming-tutorial-mecanum-drivetrain">
<h1>Programming Tutorial - Mecanum Drivetrain<a class="headerlink" href="#programming-tutorial-mecanum-drivetrain" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mecanum-physics">
<h2>Mecanum Physics<a class="headerlink" href="#mecanum-physics" title="Permalink to this headline">¶</a></h2>
<p>A very common choice for drivetrain in FTC is mecanum drive,
but we have noticed that not a lot of people know how they work or how to
properly program them.
Mecanum wheels have rollers at a 45° angle to the rest of the wheel.
Since these are in contact with the ground instead of something solid like in a
traction wheel, instead of the wheel creating a force parallel to the
orientation of the wheel,
it creates one 45° from parallel.
Depending on how the wheels are driven, X or Y components of the force vectors
can cancel which allows movement in any direction.</p>
<img alt="Force diagram of a single mecanum wheel" src="../../_images/mecanum-worms-eye-view.png" />
</div>
<div class="section" id="using-vectoring-to-create-omnidirectional-movement">
<h2>Using Vectoring to Create Omnidirectional Movement<a class="headerlink" href="#using-vectoring-to-create-omnidirectional-movement" title="Permalink to this headline">¶</a></h2>
<p>As stated earlier, depending on how the wheels are driven,
movement in any direction can be created.
This is because with 4 wheels on a robot oriented in and X orientation,
the vectors can be cancelled such that movement is created in any direction.
It is important to note that because of friction,
perfect movement isn’t possible in every direction,
so a mecanum drivetrain will be able to drive slightly faster
forwards/backwards than any other directions.</p>
<img alt="Force diagram of a complete mecanum drive" src="../../_images/mecanum-drive-force-diagram.png" />
<p>In that image, 1, 2, 3, and 4 are the force vectors created by the mecanum
wheels when driven towards the top of the image.
The blue and red lines are their X and Y components, respectively.
Here are a few examples of how the wheels must be driven to achieve different
movements (It is not recommended to hard code these in;
there is a much better mathematical way to program mecanum that allows for true
omnidirectional movement and is much cleaner):</p>
<img alt="Examples of ways to move the wheels on mecanum drive to move the robot in different directions" src="../../_images/mecanum-drive-directions.png" />
</div>
<div class="section" id="deriving-mecanum-control-equations">
<h2>Deriving Mecanum Control Equations<a class="headerlink" href="#deriving-mecanum-control-equations" title="Permalink to this headline">¶</a></h2>
<p>Before thinking about mecanum, envision a scenario where you have a 2 motor tank
drivetrain which you want to control using the left stick Y axis for
forward/backward movement, and the right stick X axis for pivot turning.
The motors are configured so that positive is clockwise for the right motor when
the body is facing away from you, and the left motor is the opposite.
To control only forward/backward movement,
you simply need to set the motor powers to the Y stick value
(flip the sign since Y is reversed):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamepad1</span><span class="o">.</span><span class="na">left_stick_y</span><span class="o">;</span> <span class="c1">// Remember, this is reversed!</span>

<span class="n">leftMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span><span class="o">);</span>
<span class="n">rightMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span><span class="o">);</span>
</pre></div>
</div>
<p>Although at first adding rotation might seem like a difficult task,
it’s actually super simple.
All you need to do is subtract the x value from the right side, and add it to
the left:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamepad1</span><span class="o">.</span><span class="na">left_stick_y</span><span class="o">;</span> <span class="c1">// Remember, this is reversed!</span>
<span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">gamepad1</span><span class="o">.</span><span class="na">right_stick_x</span><span class="o">;</span>

<span class="n">leftMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">);</span>
<span class="n">rightMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">);</span>
</pre></div>
</div>
<p>Here, if the Y stick is pressed upwards,
both of the motors will be fed a positive value, causing the robot to move
forward.
If it is pressed downwards, both of the motors will be fed a negative value,
causing the robot to move backwards.
A similar principle applies for rotation:
if the X stick is pushed rightward, the left wheels will spin forward while the
right spin backward, causing rotation.
The opposite applies for pushing the stick left.
If both sticks are pushed at the same time,
say the Y stick is at 1 and the X stick is also at 1,
the value of the left wheels will be <img class="math" src="../../_images/math/fbe6a7fc567e0f605bb827faac86fc8d5e95bd1c.svg" alt="1+1=2"/>
(which gets converted to 1 in the SDK) and the right wheels will be
<img class="math" src="../../_images/math/76eb0521ddc1a361aebc07f81c99800adc1dab61.svg" alt="1-1=0"/>, which causes a rightward curve.</p>
<p>Applying omnidirectional movement with mecanum wheels operates under the same
principle as adding turning into the tank example.
The left stick X values will be added or subtracted to each wheel depending on
how that wheel needs to rotate to get the desired movement.
The only difference between adding turning is that rather than wheels on the
same side being the same sign,
wheels diagonal to each other will be the same sign.</p>
<p>We want a positive X value to correlate to rightward strafing.
If we refer back to the vectoring image,
this means that the front left and back right need to rotate forward,
while the back left and front right need to rotate backwards.
So, we should add the x value to the front left and back right and subtract it
from the back right and front left:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamepad1</span><span class="o">.</span><span class="na">left_stick_y</span><span class="o">;</span> <span class="c1">// Remember, this is reversed!</span>
<span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">gamepad1</span><span class="o">.</span><span class="na">left_stick_x</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">rx</span> <span class="o">=</span> <span class="n">gamepad1</span><span class="o">.</span><span class="na">right_stick_x</span><span class="o">;</span>

<span class="n">frontLeftMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rx</span><span class="o">);</span>
<span class="n">backLeftMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="n">rx</span><span class="o">);</span>
<span class="n">frontRightMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="n">rx</span><span class="o">);</span>
<span class="n">backRightMotor</span><span class="o">.</span><span class="na">setPower</span><span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="n">rx</span><span class="o">);</span>
</pre></div>
</div>
<p>This is the same as the tank example,
except now with 4 motors and the strafing component added.
Similarly to the tank example, the Y component is added to all wheels,
and the right x (rx) is added to the left and subtracted from the right.
Now, we have added another component that will allow us to strafe rightward.
In doing that, however, we have actually allowed for strafing in any direction.
If you think about it, pressing the joystick to the left will do the same thing
in reverse, which is what is needed to strafe left.
If it is pressed at 45 degrees, the x and y components of the joystick will be
equal.
This will cause two diagonal motors to cancel, allowing for diagonal movement.
This same effect applies to every angle of the joystick.</p>
<p>Now that we have a functioning mecanum driving program,
there are a few things that can be done to clean it up.
The first of these would be multiplying the left X value by something to
counteract imperfect strafing.
Doing this will make the drive feel more accurate on non axis aligned
directions, and make field centric driving more accurate.
In this tutorial, we will use 1.5, but it’s really up to driver preference.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">gamepad1</span><span class="o">.</span><span class="na">left_stick_y</span><span class="o">;</span> <span class="c1">// Remember, this is reversed!</span>
<span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">gamepad1</span><span class="o">.</span><span class="na">left_stick_x</span> <span class="o">*</span> <span class="mf">1.5</span><span class="o">;</span> <span class="c1">// Counteract imperfect strafing</span>
<span class="kt">double</span> <span class="n">rx</span> <span class="o">=</span> <span class="n">gamepad1</span><span class="o">.</span><span class="na">right_stick_x</span><span class="o">;</span>
</pre></div>
</div>
<p>The other improvement we can make is scale the values into the range of -1 to 1.
Since the SDK simply rounds if the input is out of that range,
we can lose the ratio we are looking for unless we proactively put all the
numbers back in that range while still maintaining our calculated ratio.
For example, if we calculate values of 0.4, 0.1, 1.1, and 1.4,
plugging those into the motors they will become 0.4, 0.1, 1.0, and 1.0,
which is not the same ratio.
Instead, we need to divide all of them by the largest number (absolute value):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Put powers in the range of -1 to 1 only if they aren&#39;t already (not</span>
<span class="c1">// checking would cause us to always drive at full speed)</span>

<span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">frontLeftPower</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">backLeftPower</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span>
    <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">frontRightPower</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">backRightPower</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Find the largest power</span>
    <span class="kt">double</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">frontLeftPower</span><span class="o">),</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">backLeftPower</span><span class="o">));</span>
    <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">frontRightPower</span><span class="o">),</span> <span class="n">max</span><span class="o">);</span>
    <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">backRightPower</span><span class="o">),</span> <span class="n">max</span><span class="o">);</span>

    <span class="c1">// Divide everything by max (it&#39;s positive so we don&#39;t need to worry</span>
    <span class="c1">// about signs)</span>
    <span class="n">frontLeftPower</span> <span class="o">/=</span> <span class="n">max</span><span class="o">;</span>
    <span class="n">backLeftPower</span> <span class="o">/=</span> <span class="n">max</span><span class="o">;</span>
    <span class="n">frontRightPower</span> <span class="o">/=</span> <span class="n">max</span><span class="o">;</span>
    <span class="n">backRightPower</span> <span class="o">/=</span> <span class="n">max</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="control-loops.html" class="btn btn-neutral float-right" title="Control Loops" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="using-the-sdk.html" class="btn btn-neutral float-left" title="Using the FTC SDK" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Game Manual 0 Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>